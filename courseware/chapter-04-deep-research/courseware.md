# ç¬¬å››ç« ï¼šDeepAgents æ·±åº¦ç ”ç©¶ç³»ç»Ÿ

## ç†è®ºè®²è§£

### 4.1 å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¦‚è¿°ä¸æ ¸å¿ƒä»·å€¼

å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆMulti-Agent Systemï¼‰æ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸçš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œå®ƒç”±å¤šä¸ªè‡ªä¸»æ™ºèƒ½ä½“ç»„æˆï¼Œè¿™äº›æ™ºèƒ½ä½“èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–ã€ä¸å…¶ä»–æ™ºèƒ½ä½“äº¤äº’ï¼Œå…±åŒå®Œæˆå¤æ‚ä»»åŠ¡ã€‚ä¸å•ä¸€æ™ºèƒ½ä½“ç›¸æ¯”ï¼Œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿå…·æœ‰å‡ ä¸ªæ˜¾è‘—ä¼˜åŠ¿ï¼šé¦–å…ˆæ˜¯å¯æ‰©å±•æ€§ï¼Œæ–°å¢æˆ–ç§»é™¤æ™ºèƒ½ä½“ä¸ä¼šå½±å“æ•´ä½“ç³»ç»Ÿï¼›å…¶æ¬¡æ˜¯ä¸“ä¸šåˆ†å·¥ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“å¯ä»¥ä¸“æ³¨äºç‰¹å®šä»»åŠ¡ï¼Œå‘æŒ¥ä¸“é•¿ï¼›ç¬¬ä¸‰æ˜¯å¹¶è¡Œå¤„ç†ï¼Œå¤šä¸ªæ™ºèƒ½ä½“å¯ä»¥åŒæ—¶å·¥ä½œï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ï¼›ç¬¬å››æ˜¯å®¹é”™æ€§ï¼Œå•ä¸ªæ™ºèƒ½ä½“çš„æ•…éšœä¸ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚

åœ¨æ·±åº¦ç ”ç©¶åœºæ™¯ä¸­ï¼Œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„ä¼˜åŠ¿å°¤ä¸ºæ˜æ˜¾ã€‚å¤æ‚çš„ç ”ç©¶ä»»åŠ¡é€šå¸¸æ¶‰åŠå¤šä¸ªæ–¹é¢ï¼šä¿¡æ¯æ”¶é›†éœ€è¦å¹¿æ³›çš„ç½‘ç»œæœç´¢å’Œæ–‡çŒ®è°ƒç ”ï¼›ä¿¡æ¯åˆ†æéœ€è¦æ·±åº¦çš„å†…å®¹ç†è§£å’ŒçŸ¥è¯†æå–ï¼›æŠ¥å‘Šæ’°å†™éœ€è¦æ¸…æ™°çš„ç»“æ„å’Œæµç•…çš„è¡¨è¾¾ã€‚å¦‚æœè®©ä¸€ä¸ªæ™ºèƒ½ä½“åŒæ—¶å®Œæˆæ‰€æœ‰è¿™äº›ä»»åŠ¡ï¼Œä¸ä»…ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä¹Ÿä¼šé™åˆ¶æ¯ä¸ªç¯èŠ‚çš„ä¸“ä¸šæ·±åº¦ã€‚é€šè¿‡å¤šæ™ºèƒ½ä½“åˆ†å·¥ï¼Œå¯ä»¥è®©ä¸“é—¨çš„æ™ºèƒ½ä½“è´Ÿè´£ä¸“é—¨çš„ä»»åŠ¡ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½èƒ½è¾¾åˆ°æ›´é«˜çš„è´¨é‡ã€‚

LC-StudyLab é¡¹ç›®ä¸­çš„ DeepAgents æ¨¡å—æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿï¼Œå®ƒå®ç°äº†"æ·±åº¦ç ”ç©¶"è¿™ä¸€å…¸å‹æ¡ˆä¾‹ã€‚è¿™ä¸ªç³»ç»ŸåŒ…å«ä¸‰ç±»ä¸“ä¸šæ™ºèƒ½ä½“ï¼šWebResearcher è´Ÿè´£ç½‘ç»œæœç´¢å’Œä¿¡æ¯æ”¶é›†ï¼›DocAnalyst è´Ÿè´£æ–‡æ¡£åˆ†æå’Œä¿¡æ¯æå–ï¼›ReportWriter è´Ÿè´£ç ”ç©¶æŠ¥å‘Šæ’°å†™ã€‚ä¸»æ™ºèƒ½ä½“ DeepResearchAgent è´Ÿè´£ä»»åŠ¡åˆ†è§£å’Œåè°ƒï¼Œå°†å¤æ‚çš„ç ”ç©¶ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼Œåˆ†é…ç»™ä¸“é—¨çš„å­æ™ºèƒ½ä½“å¤„ç†ï¼Œæœ€ç»ˆæ±‡æ€»ç”Ÿæˆå®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šã€‚

### 4.2 å¤šæ™ºèƒ½ä½“åä½œæ¶æ„è®¾è®¡

å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„æ¶æ„è®¾è®¡éœ€è¦è§£å†³å‡ ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šæ™ºèƒ½ä½“ä¹‹é—´çš„é€šä¿¡æœºåˆ¶ã€ä»»åŠ¡çš„åˆ†è§£ä¸åˆ†é…ã€ç»“æœçš„æ±‡æ€»ä¸éªŒè¯ã€ä»¥åŠå†²çªçš„æ£€æµ‹ä¸è§£å†³ã€‚LC-StudyLab é‡‡ç”¨"ä¸»-ä»"æ¶æ„ï¼Œä¸»æ™ºèƒ½ä½“ä½œä¸ºåè°ƒè€…è´Ÿè´£æ•´ä½“è§„åˆ’å’Œä»»åŠ¡åˆ†é…ï¼Œå­æ™ºèƒ½ä½“ä½œä¸ºæ‰§è¡Œè€…è´Ÿè´£å…·ä½“ä»»åŠ¡çš„å¤„ç†ã€‚

ä¸»æ™ºèƒ½ä½“çš„æ ¸å¿ƒèŒè´£åŒ…æ‹¬ï¼šç†è§£ç”¨æˆ·çš„ç ”ç©¶éœ€æ±‚ã€åˆ¶å®šè¯¦ç»†çš„ç ”ç©¶è®¡åˆ’ã€å°†è®¡åˆ’åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„ä»»åŠ¡ã€åè°ƒå­æ™ºèƒ½ä½“çš„æ‰§è¡Œã€å¤„ç†å­æ™ºèƒ½ä½“çš„ç»“æœåé¦ˆã€ç”Ÿæˆæœ€ç»ˆçš„ç ”ç©¶æŠ¥å‘Šã€‚ä¸»æ™ºèƒ½ä½“éœ€è¦å…·å¤‡å¼ºå¤§çš„è‡ªç„¶è¯­è¨€ç†è§£èƒ½åŠ›ï¼Œèƒ½å¤Ÿå‡†ç¡®æŠŠæ¡ç”¨æˆ·çš„æ„å›¾ï¼›åŒæ—¶éœ€è¦å…·å¤‡è‰¯å¥½çš„è§„åˆ’èƒ½åŠ›ï¼Œèƒ½å¤Ÿåˆ¶å®šå‡ºåˆç†çš„ç ”ç©¶è·¯å¾„ã€‚

å­æ™ºèƒ½ä½“çš„è®¾è®¡éµå¾ª"ä¸“ä¸šåˆ†å·¥"åŸåˆ™ã€‚æ¯ä¸ªå­æ™ºèƒ½ä½“åªä¸“æ³¨äºç‰¹å®šç±»å‹çš„ä»»åŠ¡ï¼Œä½†æ¯ä¸ªä»»åŠ¡éƒ½èƒ½åšåˆ°æ·±å…¥å’Œä¸“ä¸šã€‚WebResearcher æ™ºèƒ½ä½“ä¸“æ³¨äºä¿¡æ¯æ”¶é›†ï¼Œå®ƒèƒ½å¤Ÿè¿›è¡Œç½‘ç»œæœç´¢ã€ç­›é€‰é«˜è´¨é‡æ¥æºã€æå–å…³é”®ä¿¡æ¯ï¼›DocAnalyst æ™ºèƒ½ä½“ä¸“æ³¨äºä¿¡æ¯åˆ†æï¼Œå®ƒèƒ½å¤Ÿé˜…è¯»å’Œç†è§£æ–‡æ¡£å†…å®¹ã€æå–å…³é”®è®ºç‚¹å’Œæ•°æ®ã€è¯†åˆ«ä¿¡æ¯ä¹‹é—´çš„å…³è”ï¼›ReportWriter æ™ºèƒ½ä½“ä¸“æ³¨äºæŠ¥å‘Šç”Ÿæˆï¼Œå®ƒèƒ½å¤Ÿç»„ç»‡å†…å®¹ç»“æ„ã€æ’°å†™æ¸…æ™°çš„æ®µè½ã€ç”Ÿæˆè§„èŒƒçš„å¼•ç”¨ã€‚

æ™ºèƒ½ä½“ä¹‹é—´çš„é€šä¿¡é‡‡ç”¨æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚æ¯ä¸ªæ™ºèƒ½ä½“æœ‰è‡ªå·±ç‹¬ç«‹çš„è¾“å…¥å’Œè¾“å‡ºæ¥å£ï¼Œä¸»æ™ºèƒ½ä½“é€šè¿‡å‘é€æ¶ˆæ¯è§¦å‘å­æ™ºèƒ½ä½“çš„æ‰§è¡Œï¼Œå­æ™ºèƒ½ä½“é€šè¿‡è¿”å›æ¶ˆæ¯æŠ¥å‘Šæ‰§è¡Œç»“æœå’Œè·å–çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™ç§æ¾è€¦åˆçš„è®¾è®¡ä½¿å¾—æ™ºèƒ½ä½“å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•ï¼Œåªéœ€è¦éµå¾ªçº¦å®šçš„æ¶ˆæ¯æ ¼å¼å³å¯ã€‚

### 4.3 ç ”ç©¶è®¡åˆ’ç”Ÿæˆä¸ä»»åŠ¡åˆ†è§£

ç ”ç©¶è®¡åˆ’ç”Ÿæˆæ˜¯æ·±åº¦ç ”ç©¶çš„ç¬¬ä¸€æ­¥ï¼Œå®ƒå†³å®šäº†åç»­ç ”ç©¶çš„æ–¹å‘å’Œè·¯å¾„ã€‚ä¸€ä¸ªå¥½çš„ç ”ç©¶è®¡åˆ’åº”è¯¥åŒ…å«ï¼šæ˜ç¡®çš„ç ”ç©¶ç›®æ ‡ã€æ¸…æ™°çš„ç ”ç©¶é—®é¢˜ã€åˆç†çš„æ—¶é—´å®‰æ’ã€å……åˆ†çš„ä¿¡æ¯æ¥æºè€ƒè™‘ã€‚LC-StudyLab çš„ä¸»æ™ºèƒ½ä½“ä½¿ç”¨ LLM ç”Ÿæˆç ”ç©¶è®¡åˆ’ï¼Œè®¡åˆ’çš„è¯¦ç»†ç¨‹åº¦å¯ä»¥æ ¹æ®ç”¨æˆ·éœ€æ±‚å’Œç ”ç©¶å¤æ‚åº¦è¿›è¡Œè°ƒæ•´ã€‚

ä»»åŠ¡åˆ†è§£æ˜¯å°†ç ”ç©¶è®¡åˆ’è½¬åŒ–ä¸ºå¯æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ã€‚åˆ†è§£çš„åŸåˆ™æ˜¯"ç²’åº¦é€‚ä¸­"ï¼šä»»åŠ¡å¤ªå¤§ä¼šéš¾ä»¥ç®¡ç†ï¼Œä»»åŠ¡å¤ªå°ä¼šäº§ç”Ÿè¿‡å¤šçš„åè°ƒå¼€é”€ã€‚æ¯ä¸ªå­ä»»åŠ¡åº”è¯¥æœ‰æ˜ç¡®çš„è¾“å…¥ã€è¾“å‡ºå’Œå®Œæˆæ ‡å‡†ï¼Œä¾¿äºå­æ™ºèƒ½ä½“æ‰§è¡Œå’Œä¸»æ™ºèƒ½ä½“éªŒæ”¶ã€‚åˆ†è§£æ—¶è¿˜éœ€è¦è€ƒè™‘ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒæŸäº›ä»»åŠ¡å¯èƒ½éœ€è¦ç­‰å¾…å‰ç½®ä»»åŠ¡å®Œæˆåæ‰èƒ½å¼€å§‹ã€‚

ç ”ç©¶è®¡åˆ’éœ€è¦ç»è¿‡ç”¨æˆ·ç¡®è®¤æ‰èƒ½æ‰§è¡Œã€‚äººç±»ä¸“å®¶çš„çŸ¥è¯†å’Œåˆ¤æ–­åŠ›æ˜¯ AI éš¾ä»¥å®Œå…¨æ›¿ä»£çš„ï¼Œç”¨æˆ·å¯ä»¥è¡¥å……ç ”ç©¶æ–¹å‘ã€ä¿®æ­£è®¡åˆ’ä¸­çš„é”™è¯¯ã€è°ƒæ•´ä¼˜å…ˆçº§ã€‚ç¡®è®¤åçš„è®¡åˆ’ä½œä¸ºåç»­æ‰§è¡Œçš„åŸºç¡€ï¼Œä¸»æ™ºèƒ½ä½“ä¼šä¸¥æ ¼æŒ‰ç…§è®¡åˆ’æ¨è¿›ç ”ç©¶è¿›ç¨‹ã€‚å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°è®¡åˆ’éœ€è¦è°ƒæ•´ï¼Œä¸»æ™ºèƒ½ä½“ä¼šå‘ç”¨æˆ·è¯·æ±‚ç¡®è®¤ã€‚

### 4.4 æ–‡ä»¶ç³»ç»Ÿå·¥å…·é›†æˆ

æ–‡ä»¶ç³»ç»Ÿå·¥å…·æ˜¯å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒè®©æ™ºèƒ½ä½“èƒ½å¤ŸæŒä¹…åŒ–å­˜å‚¨å’Œè¯»å–ç ”ç©¶è¿‡ç¨‹ä¸­æ”¶é›†çš„èµ„æ–™ã€ç”Ÿæˆçš„è‰ç¨¿å’Œæœ€ç»ˆçš„æŠ¥å‘Šã€‚LC-StudyLab çš„æ–‡ä»¶ç³»ç»Ÿå·¥å…·æ”¯æŒå¤šç§æ“ä½œï¼šè¯»å–æ–‡ä»¶å†…å®¹ã€å†™å…¥æ–°æ–‡ä»¶ã€åˆ›å»ºç›®å½•ã€åˆ—å‡ºç›®å½•å†…å®¹ã€åˆ é™¤æ–‡ä»¶ç­‰ã€‚

æ–‡ä»¶æ“ä½œçš„æ¥å£è®¾è®¡éµå¾ªç®€å•æ˜“ç”¨çš„åŸåˆ™ã€‚æ¯ä¸ªæ“ä½œéƒ½æ˜¯ç‹¬ç«‹çš„å·¥å…·å‡½æ•°ï¼Œæ¥å—æ˜ç¡®çš„å‚æ•°ï¼Œè¿”å›æ¸…æ™°çš„ç»“æœã€‚æ–‡ä»¶è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„ç›¸å¯¹äºå·¥ä½œç›®å½•è§£æã€‚glob æ¨¡å¼çš„æ–‡ä»¶æœç´¢åŠŸèƒ½è®©æ™ºèƒ½ä½“èƒ½å¤Ÿæ‰¹é‡æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶ã€‚

æ–‡ä»¶ç»„ç»‡æ˜¯ç ”ç©¶ç³»ç»Ÿçš„é‡è¦æ–¹é¢ã€‚LC-StudyLab é‡‡ç”¨ç»“æ„åŒ–çš„ç›®å½•ç»„ç»‡æ–¹å¼ï¼šæ¯ä¸ªç ”ç©¶ä»»åŠ¡æœ‰ç‹¬ç«‹çš„ç›®å½•ï¼Œä¸‹è®¾"sources"å­˜æ”¾åŸå§‹èµ„æ–™ã€"drafts"å­˜æ”¾ä¸­é—´è‰ç¨¿ã€"reports"å­˜æ”¾æœ€ç»ˆæŠ¥å‘Šã€‚è¿™ç§ç»„ç»‡æ–¹å¼ä¾¿äºç®¡ç†å’Œè¿½æº¯ï¼Œä¹Ÿä¾¿äºç”¨æˆ·æŸ¥çœ‹ç ”ç©¶çš„ä¸­é—´è¿‡ç¨‹ã€‚

### 4.5 ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆ

ç ”ç©¶æŠ¥å‘Šæ˜¯æ·±åº¦ç ”ç©¶çš„æœ€ç»ˆäº§å‡ºï¼Œå®ƒçš„è´¨é‡ç›´æ¥å½±å“ç ”ç©¶çš„ä»·å€¼ã€‚LC-StudyLab çš„ ReportWriter æ™ºèƒ½ä½“èƒ½å¤Ÿç”Ÿæˆç»“æ„åŒ–çš„ Markdown æ ¼å¼æŠ¥å‘Šï¼ŒåŒ…å«æ ‡é¢˜ã€æ‘˜è¦ã€ç« èŠ‚ã€å¼•ç”¨ã€å‚è€ƒæ–‡çŒ®ç­‰æ ‡å‡†ç»“æ„ã€‚æŠ¥å‘Šé‡‡ç”¨"å…ˆå¤§çº²åå†…å®¹"çš„ç”Ÿæˆç­–ç•¥ï¼Œå…ˆæ„å»ºæŠ¥å‘Šæ¡†æ¶ï¼Œå†é€æ­¥å¡«å……è¯¦ç»†å†…å®¹ã€‚

æŠ¥å‘Šçš„è§„èŒƒæ€§æ˜¯ä¸“ä¸šç ”ç©¶çš„åŸºæœ¬è¦æ±‚ã€‚æŠ¥å‘Šåº”è¯¥æœ‰æ¸…æ™°çš„å±‚çº§ç»“æ„ï¼Œæ ‡é¢˜å’Œå°èŠ‚çš„ç»„ç»‡é€»è¾‘ä¸¥å¯†ï¼›åº”è¯¥æœ‰å……åˆ†çš„å¼•ç”¨æ ‡æ³¨ï¼Œæ‰€æœ‰å¼•ç”¨çš„æ¥æºéƒ½åº”è¯¥æœ‰å¯¹åº”çš„å¼•ç”¨æ ‡è®°ï¼›åº”è¯¥æœ‰è§„èŒƒçš„å‚è€ƒæ–‡çŒ®åˆ—è¡¨ï¼Œåˆ—å‡ºæ‰€æœ‰å‚è€ƒçš„èµ„æ–™æ¥æºã€‚ReportWriter æ™ºèƒ½ä½“åœ¨ç”ŸæˆæŠ¥å‘Šæ—¶ä¼šè‡ªåŠ¨æ·»åŠ è¿™äº›ç»“æ„å…ƒç´ ã€‚

æŠ¥å‘Šçš„ä¸ªæ€§åŒ–å®šåˆ¶æ˜¯æé«˜ç”¨æˆ·æ»¡æ„åº¦çš„é‡è¦æ‰‹æ®µã€‚ç”¨æˆ·å¯ä»¥æŒ‡å®šæŠ¥å‘Šçš„æ ¼å¼è¦æ±‚ã€ç¯‡å¹…é™åˆ¶ã€é‡ç‚¹å…³æ³¨çš„æ–¹é¢ç­‰ã€‚ReportWriter æ™ºèƒ½ä½“ä¼šæ ¹æ®ç”¨æˆ·çš„è¦æ±‚è°ƒæ•´æŠ¥å‘Šçš„å†…å®¹å’Œé£æ ¼ï¼Œç”Ÿæˆæ»¡è¶³ç”¨æˆ·ç‰¹å®šéœ€æ±‚çš„ç ”ç©¶æŠ¥å‘Šã€‚

## å®æ“æ­¥éª¤

### 4.1 ç ”ç©¶ç³»ç»Ÿç¯å¢ƒå‡†å¤‡

é¦–å…ˆæŸ¥çœ‹ DeepAgents æ¨¡å—çš„ç›®å½•ç»“æ„ï¼š

```
backend/deep_research/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ deep_agent.py           # ä¸»æ™ºèƒ½ä½“
â”œâ”€â”€ deep_researcher.py      # ç ”ç©¶åè°ƒè€…ï¼ˆå·²åºŸå¼ƒï¼Œä¿ç•™å‘åå…¼å®¹ï¼‰
â”œâ”€â”€ safe_deep_agent.py      # å®‰å…¨ç‰ˆæœ¬ä¸»æ™ºèƒ½ä½“
â””â”€â”€ subagents.py            # å­æ™ºèƒ½ä½“å®šä¹‰
```

ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…ï¼š

```bash
# æ£€æŸ¥ä¾èµ–
cd backend
pip list | grep -E "langchain|openai|pydantic"
```

### 4.2 å­æ™ºèƒ½ä½“å®ç°

é¦–å…ˆåˆ›å»ºå­æ™ºèƒ½ä½“çš„åŸºç¡€ç±»ï¼š

```python
# deep_research/subagents.pyï¼ˆæ ¸å¿ƒä»£ç è§£æï¼‰

from typing import Dict, List, Any, Optional
from abc import ABC, abstractmethod
from langchain_core.tools import BaseTool
from agents.base_agent import BaseAgent
from config import get_logger

logger = get_logger(__name__)


class BaseSubAgent(ABC):
    """å­æ™ºèƒ½ä½“åŸºç±»"""
    
    @property
    @abstractmethod
    def name(self) -> str:
        """æ™ºèƒ½ä½“åç§°"""
        pass
    
    @property
    @abstractmethod
    def description(self) -> str:
        """æ™ºèƒ½ä½“æè¿°"""
        pass
    
    @abstractmethod
    def get_system_prompt(self) -> str:
        """è·å–ç³»ç»Ÿæç¤ºè¯"""
        pass
    
    @abstractmethod
    def get_tools(self) -> List[BaseTool]:
        """è·å–æ™ºèƒ½ä½“å·¥å…·åˆ—è¡¨"""
        pass
    
    def create_agent(self) -> BaseAgent:
        """åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹"""
        return BaseAgent(
            tools=self.get_tools(),
            system_prompt=self.get_system_prompt(),
            prompt_mode="detailed"
        )
    
    @abstractmethod
    def execute(self, task: str, context: Dict[str, Any] = None) -> Dict[str, Any]:
        """
        æ‰§è¡Œä»»åŠ¡
        
        Args:
            task: ä»»åŠ¡æè¿°
            context: ä¸Šä¸‹æ–‡ä¿¡æ¯
            
        Returns:
            æ‰§è¡Œç»“æœ
        """
        pass


class WebResearcherSubAgent(BaseSubAgent):
    """ç½‘ç»œç ”ç©¶è€…å­æ™ºèƒ½ä½“"""
    
    @property
    def name(self) -> str:
        return "WebResearcher"
    
    @property
    def description(self) -> str:
        return "è´Ÿè´£ç½‘ç»œæœç´¢å’Œä¿¡æ¯æ”¶é›†çš„æ™ºèƒ½ä½“"
    
    def get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ï¼Œä¸“æ³¨äºç½‘ç»œæœç´¢å’Œä¿¡æ¯æ”¶é›†ã€‚

ä½ çš„èŒè´£ï¼š
1. æ ¹æ®ç ”ç©¶ä¸»é¢˜è¿›è¡Œå…¨é¢çš„ç½‘ç»œæœç´¢
2. ç­›é€‰é«˜è´¨é‡ã€å¯ä¿¡èµ–çš„ä¿¡æ¯æ¥æº
3. æå–å…³é”®ä¿¡æ¯å’Œé‡è¦æ•°æ®
4. å¯¹æ”¶é›†çš„ä¿¡æ¯è¿›è¡Œåˆæ­¥æ•´ç†

å·¥ä½œè¦æ±‚ï¼š
- ä¼˜å…ˆé€‰æ‹©æƒå¨æœºæ„å’Œä¸“ä¸šç½‘ç«™çš„èµ„æ–™
- æ³¨æ„ä¿¡æ¯çš„æ—¶æ•ˆæ€§å’Œå‡†ç¡®æ€§
- è®°å½•æ‰€æœ‰ä¿¡æ¯æ¥æºï¼ˆæ ‡é¢˜ã€URLã€æ—¥æœŸï¼‰
- å¯¹å¤šä¸ªæ¥æºçš„ä¿¡æ¯è¿›è¡Œäº¤å‰éªŒè¯

è¾“å‡ºæ ¼å¼ï¼š
æ¯æ¡ä¿¡æ¯åº”åŒ…å«ï¼š
- ä¿¡æ¯æ ‡é¢˜
- å…³é”®å†…å®¹æ‘˜è¦
- æ¥æºé“¾æ¥
- è·å–æ—¥æœŸ
"""
    
    def get_tools(self) -> List[BaseTool]:
        """è·å–ç½‘ç»œæœç´¢å·¥å…·"""
        from core.tools import web_search
        return [web_search]
    
    def execute(self, task: str, context: Dict[str, Any] = None) -> Dict[str, Any]:
        """æ‰§è¡Œç½‘ç»œç ”ç©¶ä»»åŠ¡"""
        logger.info(f"ğŸ” WebResearcher æ‰§è¡Œä»»åŠ¡: {task}")
        
        agent = self.create_agent()
        result = agent.invoke(task)
        
        return {
            "agent": self.name,
            "task": task,
            "result": result,
            "sources": []  # å¯ä»¥ä»å·¥å…·è°ƒç”¨ç»“æœä¸­æå–
        }


class DocAnalystSubAgent(BaseSubAgent):
    """æ–‡æ¡£åˆ†æå­æ™ºèƒ½ä½“"""
    
    @property
    def name(self) -> str:
        return "DocAnalyst"
    
    @property
    def description(self) -> str:
        return "è´Ÿè´£æ–‡æ¡£åˆ†æå’Œä¿¡æ¯æå–çš„æ™ºèƒ½ä½“"
    
    def get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡£åˆ†æåŠ©æ‰‹ï¼Œä¸“æ³¨äºæ·±åº¦é˜…è¯»å’Œä¿¡æ¯æå–ã€‚

ä½ çš„èŒè´£ï¼š
1. é˜…è¯»å¹¶ç†è§£æ–‡æ¡£å†…å®¹
2. æå–å…³é”®æ¦‚å¿µå’Œæ ¸å¿ƒè®ºç‚¹
3. åˆ†æä¿¡æ¯ä¹‹é—´çš„å…³è”å’Œé€»è¾‘å…³ç³»
4. è¯†åˆ«é‡è¦çš„æ•°æ®å’Œäº‹å®

å·¥ä½œè¦æ±‚ï¼š
- å‡†ç¡®æŠŠæ¡ä½œè€…çš„æ ¸å¿ƒè§‚ç‚¹
- æ³¨æ„ä¿¡æ¯ä¹‹é—´çš„é€»è¾‘å…³ç³»
- åŒºåˆ†äº‹å®é™ˆè¿°å’Œè§‚ç‚¹è¡¨è¾¾
- è¯†åˆ«ä¿¡æ¯çš„å¯é æ€§å’Œå±€é™æ€§

è¾“å‡ºæ ¼å¼ï¼š
åˆ†æç»“æœåº”åŒ…å«ï¼š
- æ–‡æ¡£æ¦‚è¿°ï¼ˆ1-2å¥è¯ï¼‰
- å…³é”®å‘ç°ï¼ˆ3-5ä¸ªè¦ç‚¹ï¼‰
- é‡è¦æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
- ä¿¡æ¯å…³è”åˆ†æ
"""
    
    def get_tools(self) -> List[BaseTool]:
        """è·å–æ–‡ä»¶ç³»ç»Ÿå·¥å…·"""
        from core.tools import filesystem
        return [filesystem]
    
    def execute(self, task: str, context: Dict[str, Any] = None) -> Dict[str, Any]:
        """æ‰§è¡Œæ–‡æ¡£åˆ†æä»»åŠ¡"""
        logger.info(f"ğŸ“„ DocAnalyst æ‰§è¡Œä»»åŠ¡: {task}")
        
        agent = self.create_agent()
        result = agent.invoke(task)
        
        return {
            "agent": self.name,
            "task": task,
            "result": result,
            "analysis": result
        }


class ReportWriterSubAgent(BaseSubAgent):
    """æŠ¥å‘Šæ’°å†™å­æ™ºèƒ½ä½“"""
    
    @property
    def name(self) -> str:
        return "ReportWriter"
    
    @property
    def description(self) -> str:
        return "è´Ÿè´£ç ”ç©¶æŠ¥å‘Šæ’°å†™çš„æ™ºèƒ½ä½“"
    
    def get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶æŠ¥å‘Šæ’°å†™åŠ©æ‰‹ã€‚

ä½ çš„èŒè´£ï¼š
1. æ ¹æ®æ”¶é›†çš„èµ„æ–™æ’°å†™ç»“æ„æ¸…æ™°çš„ç ”ç©¶æŠ¥å‘Š
2. ä½¿ç”¨è§„èŒƒã€ä¸“ä¸šçš„è¯­è¨€è¡¨è¾¾
3. ç¡®ä¿æŠ¥å‘Šå†…å®¹å‡†ç¡®ã€é€»è¾‘ä¸¥å¯†
4. æ­£ç¡®å¼•ç”¨æ‰€æœ‰å‚è€ƒèµ„æ–™

æŠ¥å‘Šç»“æ„ï¼š
1. æ ‡é¢˜
2. æ‘˜è¦
3. å¼•è¨€
4. ç ”ç©¶æ–¹æ³•
5. ä¸»è¦å‘ç°
6. ç»“è®ºä¸å»ºè®®
7. å‚è€ƒæ–‡çŒ®

å·¥ä½œè¦æ±‚ï¼š
- æŠ¥å‘Šåº”è¯¥æœ‰æ¸…æ™°çš„é€»è¾‘ç»“æ„
- ä½¿ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€
- é€‚å½“å¼•ç”¨ä¿¡æ¯æ¥æº
- ä¿æŒå®¢è§‚ã€ä¸“ä¸šçš„å†™ä½œé£æ ¼
"""
    
    def get_tools(self) -> List[BaseTool]:
        """è·å–æ–‡ä»¶ç³»ç»Ÿå·¥å…·"""
        from core.tools import filesystem
        return [filesystem]
    
    def execute(self, task: str, context: Dict[str, Any] = None) -> Dict[str, Any]:
        """æ‰§è¡ŒæŠ¥å‘Šæ’°å†™ä»»åŠ¡"""
        logger.info(f"ğŸ“ ReportWriter æ‰§è¡Œä»»åŠ¡: {task}")
        
        agent = self.create_agent()
        result = agent.invoke(task)
        
        return {
            "agent": self.name,
            "task": task,
            "result": result,
            "report": result
        }
```

### 4.3 ä¸»æ™ºèƒ½ä½“å®ç°

åˆ›å»ºä¸»æ™ºèƒ½ä½“ DeepResearchAgentï¼š

```python
# deep_research/deep_agent.pyï¼ˆæ ¸å¿ƒä»£ç è§£æï¼‰

from typing import Dict, List, Any, Optional
from datetime import datetime
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_openai import ChatOpenAI
from config import settings, get_logger
from deep_research.subagents import (
    WebResearcherSubAgent,
    DocAnalystSubAgent,
    ReportWriterSubAgent
)

logger = get_logger(__name__)


class DeepResearchAgent:
    """
    æ·±åº¦ç ”ç©¶æ™ºèƒ½ä½“
    
    å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿçš„ä¸»åè°ƒè€…ã€‚
    è´Ÿè´£ä»»åŠ¡åˆ†è§£ã€å­æ™ºèƒ½ä½“è°ƒåº¦å’Œç»“æœæ±‡æ€»ã€‚
    
    Attributes:
        model: LLM æ¨¡å‹å®ä¾‹
        subagents: å­æ™ºèƒ½ä½“å­—å…¸
    """
    
    def __init__(self, model_name: str = None):
        """
        åˆå§‹åŒ–æ·±åº¦ç ”ç©¶æ™ºèƒ½ä½“
        
        Args:
            model_name: æ¨¡å‹åç§°
        """
        self.model = ChatOpenAI(
            model=model_name or settings.openai_model,
            temperature=0.7,
            api_key=settings.openai_api_key,
            base_url=settings.openai_api_base
        )
        
        # åˆå§‹åŒ–å­æ™ºèƒ½ä½“
        self.subagents = {
            "web_researcher": WebResearcherSubAgent(),
            "doc_analyst": DocAnalystSubAgent(),
            "report_writer": ReportWriterSubAgent()
        }
        
        logger.info("ğŸ¤– DeepResearchAgent åˆå§‹åŒ–å®Œæˆ")
        logger.info(f"   å­æ™ºèƒ½ä½“: {', '.join(self.subagents.keys())}")
    
    def create_research_plan(
        self,
        topic: str,
        goals: List[str] = None
    ) -> Dict[str, Any]:
        """
        åˆ›å»ºç ”ç©¶è®¡åˆ’
        
        Args:
            topic: ç ”ç©¶ä¸»é¢˜
            goals: ç ”ç©¶ç›®æ ‡åˆ—è¡¨
            
        Returns:
            ç ”ç©¶è®¡åˆ’å­—å…¸
        """
        logger.info(f"ğŸ“‹ åˆ›å»ºç ”ç©¶è®¡åˆ’: {topic}")
        
        prompt = f"""ä¸ºä»¥ä¸‹ç ”ç©¶ä¸»é¢˜åˆ¶å®šè¯¦ç»†çš„ç ”ç©¶è®¡åˆ’ï¼š

**ç ”ç©¶ä¸»é¢˜**: {topic}

**ç ”ç©¶ç›®æ ‡**:
{chr(10).join([f'- {g}' for g in goals]) if goals else '- å…¨é¢äº†è§£è¯¥ä¸»é¢˜'}

è¯·åˆ¶å®šä¸€ä¸ªç»“æ„åŒ–çš„ç ”ç©¶è®¡åˆ’ï¼ŒåŒ…æ‹¬ï¼š
1. ç ”ç©¶èŒƒå›´ç•Œå®š
2. å…³é”®ç ”ç©¶é—®é¢˜ï¼ˆ3-5ä¸ªï¼‰
3. æ¨èçš„ä¿¡æ¯æ¥æºç±»å‹
4. é¢„è®¡çš„ç ”ç©¶æ­¥éª¤
5. æ—¶é—´åˆ†é…å»ºè®®

è¯·ä»¥ JSON æ ¼å¼è¿”å›ç ”ç©¶è®¡åˆ’ã€‚"""
        
        response = self.model.invoke([HumanMessage(content=prompt)])
        plan_text = response.content
        
        logger.info("âœ… ç ”ç©¶è®¡åˆ’åˆ›å»ºå®Œæˆ")
        
        return {
            "topic": topic,
            "goals": goals,
            "plan": plan_text,
            "created_at": datetime.now().isoformat()
        }
    
    def decompose_tasks(self, plan: str) -> List[Dict[str, Any]]:
        """
        å°†ç ”ç©¶è®¡åˆ’åˆ†è§£ä¸ºå…·ä½“ä»»åŠ¡
        
        Args:
            plan: ç ”ç©¶è®¡åˆ’æ–‡æœ¬
            
        Returns:
            ä»»åŠ¡åˆ—è¡¨
        """
        prompt = f"""å°†ä»¥ä¸‹ç ”ç©¶è®¡åˆ’åˆ†è§£ä¸ºå…·ä½“çš„æ‰§è¡Œä»»åŠ¡ã€‚

**ç ”ç©¶è®¡åˆ’**:
{plan}

è¯·å°†è®¡åˆ’åˆ†è§£ä¸º 5-8 ä¸ªå…·ä½“ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…å«ï¼š
1. ä»»åŠ¡åç§°ï¼ˆç®€æ´æè¿°ï¼‰
2. ä»»åŠ¡ç±»å‹ï¼ˆweb_research/doc_analysis/report_writingï¼‰
3. ä»»åŠ¡æè¿°ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰
4. å‰ç½®ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰

è¯·ä»¥ JSON æ•°ç»„æ ¼å¼è¿”å›ä»»åŠ¡åˆ—è¡¨ã€‚"""
        
        response = self.model.invoke([HumanMessage(content=prompt)])
        tasks_text = response.content
        
        # è§£æä»»åŠ¡åˆ—è¡¨ï¼ˆç®€åŒ–å¤„ç†ï¼‰
        import json
        try:
            tasks = json.loads(tasks_text)
        except json.JSONDecodeError:
            # è§£æå¤±è´¥æ—¶çš„é»˜è®¤å¤„ç†
            tasks = [
                {
                    "name": "ç½‘ç»œæœç´¢",
                    "type": "web_research",
                    "description": "æœç´¢ç›¸å…³ä¿¡æ¯"
                }
            ]
        
        logger.info(f"ğŸ“¦ ä»»åŠ¡åˆ†è§£å®Œæˆ: {len(tasks)} ä¸ªä»»åŠ¡")
        
        return tasks
    
    def execute_research(
        self,
        topic: str,
        goals: List[str] = None,
        context: Dict[str, Any] = None
    ) -> Dict[str, Any]:
        """
        æ‰§è¡Œå®Œæ•´çš„ç ”ç©¶æµç¨‹
        
        Args:
            topic: ç ”ç©¶ä¸»é¢˜
            goals: ç ”ç©¶ç›®æ ‡
            context: é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
            
        Returns:
            ç ”ç©¶ç»“æœ
        """
        logger.info(f"ğŸš€ å¼€å§‹æ·±åº¦ç ”ç©¶: {topic}")
        
        # 1. åˆ›å»ºç ”ç©¶è®¡åˆ’
        plan = self.create_research_plan(topic, goals)
        
        # 2. åˆ†è§£ä»»åŠ¡
        tasks = self.decompose_tasks(plan["plan"])
        
        # 3. æ‰§è¡Œä»»åŠ¡ï¼ˆç®€åŒ–å¤„ç†ï¼‰
        results = {
            "research_topic": topic,
            "research_goals": goals,
            "research_plan": plan,
            "task_results": [],
            "final_report": None,
            "sources": [],
            "executed_at": datetime.now().isoformat()
        }
        
        # æ‰§è¡Œæ¯ä¸ªä»»åŠ¡
        for task in tasks:
            task_type = task.get("type", "web_research")
            task_desc = task.get("description", "")
            
            # é€‰æ‹©å¯¹åº”çš„å­æ™ºèƒ½ä½“
            if task_type == "web_researcher":
                subagent = self.subagents["web_researcher"]
            elif task_type == "doc_analyst":
                subagent = self.subagents["doc_analyst"]
            elif task_type == "report_writer":
                subagent = self.subagents["report_writer"]
            else:
                subagent = self.subagents["web_researcher"]
            
            # æ‰§è¡Œä»»åŠ¡
            task_result = subagent.execute(task_desc, context)
            results["task_results"].append(task_result)
            
            logger.info(f"   å®Œæˆä»»åŠ¡: {task['name']} ({task_type})")
        
        # 4. æ±‡æ€»ç»“æœ
        results["final_report"] = self._generate_final_report(results)
        
        logger.info("âœ… æ·±åº¦ç ”ç©¶å®Œæˆ")
        
        return results
    
    def _generate_final_report(self, research_results: Dict) -> str:
        """ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š"""
        # æ”¶é›†æ‰€æœ‰å­æ™ºèƒ½ä½“çš„ç»“æœ
        all_findings = []
        for result in research_results.get("task_results", []):
            if isinstance(result, dict) and "result" in result:
                all_findings.append(result["result"])
        
        prompt = f"""åŸºäºä»¥ä¸‹ç ”ç©¶ç»“æœï¼Œç”Ÿæˆä¸€ä»½å®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šï¼š

**ç ”ç©¶ä¸»é¢˜**: {research_results.get('research_topic', '')}

**ç ”ç©¶ç›®æ ‡**:
{chr(10).join([f'- {g}' for g in research_results.get('research_goals', [])])}

**ç ”ç©¶è¿‡ç¨‹å‘ç°**:
{chr(10).chr(10).join(all_findings)}

è¯·ç”Ÿæˆä¸€ä»½ç»“æ„å®Œæ•´ã€å†…å®¹è¯¦å®çš„ç ”ç©¶æŠ¥å‘Šã€‚"""
        
        response = self.model.invoke([HumanMessage(content=prompt)])
        
        return response.content


class DeepResearcher:
    """æ·±åº¦ç ”ç©¶è€…ï¼ˆä¿ç•™å‘åå…¼å®¹ï¼‰"""
    
    def __init__(self):
        self.agent = DeepResearchAgent()
    
    async def research(
        self,
        topic: str,
        goals: List[str] = None
    ) -> Dict[str, Any]:
        """
        æ‰§è¡Œç ”ç©¶
        
        Args:
            topic: ç ”ç©¶ä¸»é¢˜
            goals: ç ”ç©¶ç›®æ ‡
            
        Returns:
            ç ”ç©¶ç»“æœ
        """
        return self.agent.execute_research(topic, goals)
```

### 4.4 æ·±åº¦ç ”ç©¶å®è·µ

åˆ›å»ºæ·±åº¦ç ”ç©¶ç¤ºä¾‹è„šæœ¬ï¼š

```python
# examples/ch04/01_deep_research.py
"""
æ·±åº¦ç ”ç©¶ç¤ºä¾‹
å­¦ä¹ å¦‚ä½•ä½¿ç”¨å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè¿›è¡Œæ·±åº¦ç ”ç©¶
"""

import asyncio
from deep_research import DeepResearcher
from config import get_logger

logger = get_logger(__name__)


async def main():
    """è¿è¡Œæ·±åº¦ç ”ç©¶ç¤ºä¾‹"""
    
    print("=" * 60)
    print("ğŸ”¬ DeepAgents æ·±åº¦ç ”ç©¶ç³»ç»Ÿç¤ºä¾‹")
    print("=" * 60)
    
    # åˆ›å»ºç ”ç©¶è€…
    researcher = DeepResearcher()
    
    # å®šä¹‰ç ”ç©¶ä¸»é¢˜
    topic = "å¤§è¯­è¨€æ¨¡å‹åœ¨æ•™è‚²é¢†åŸŸçš„åº”ç”¨"
    goals = [
        "äº†è§£ LLM åœ¨æ•™è‚²ä¸­çš„ä¸»è¦åº”ç”¨åœºæ™¯",
        "åˆ†ææˆåŠŸçš„æ•™è‚² LLM åº”ç”¨æ¡ˆä¾‹",
        "æ¢è®¨ LLM æ•™è‚²åº”ç”¨é¢ä¸´çš„æŒ‘æˆ˜",
        "æ€»ç»“ LLM æ•™è‚²åº”ç”¨çš„æœªæ¥è¶‹åŠ¿"
    ]
    
    print(f"\nğŸ“ ç ”ç©¶ä¸»é¢˜: {topic}")
    print("ğŸ¯ ç ”ç©¶ç›®æ ‡:")
    for goal in goals:
        print(f"   - {goal}")
    
    # æ‰§è¡Œç ”ç©¶
    print("\nğŸš€ å¼€å§‹æ·±åº¦ç ”ç©¶...")
    print("   (è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´)\n")
    
    try:
        result = await researcher.research(topic, goals)
        
        # æ˜¾ç¤ºç»“æœ
        print("\n" + "=" * 60)
        print("ğŸ“Š æ·±åº¦ç ”ç©¶ç»“æœ")
        print("=" * 60)
        
        # æ˜¾ç¤ºç ”ç©¶è®¡åˆ’
        if "research_plan" in result:
            plan = result["research_plan"]
            if isinstance(plan, dict) and "plan" in plan:
                print("\nğŸ“‹ ç ”ç©¶è®¡åˆ’:")
                print("-" * 40)
                print(plan["plan"][:500] + "...")
        
        # æ˜¾ç¤ºæœ€ç»ˆæŠ¥å‘Š
        if "final_report" in result:
            print("\nğŸ“„ ç ”ç©¶æŠ¥å‘Š:")
            print("-" * 40)
            print(result["final_report"][:1000] + "...")
        
        # æ˜¾ç¤ºä»»åŠ¡ç»Ÿè®¡
        if "task_results" in result:
            print(f"\nğŸ“ˆ æ‰§è¡Œäº† {len(result['task_results'])} ä¸ªç ”ç©¶ä»»åŠ¡")
            
            agent_stats = {}
            for task_result in result["task_results"]:
                agent_name = task_result.get("agent", "Unknown")
                agent_stats[agent_name] = agent_stats.get(agent_name, 0) + 1
            
            for agent, count in agent_stats.items():
                print(f"   - {agent}: {count} ä¸ªä»»åŠ¡")
        
        print("\n" + "=" * 60)
        print("âœ… æ·±åº¦ç ”ç©¶å®Œæˆï¼")
        print("=" * 60)
        
    except Exception as e:
        logger.error(f"âŒ ç ”ç©¶è¿‡ç¨‹å‡ºé”™: {e}")
        print(f"\nç ”ç©¶è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {e}")


def sync_demo():
    """åŒæ­¥ç‰ˆæœ¬æ¼”ç¤º"""
    
    print("\n" + "=" * 60)
    print("ğŸ”¬ åŒæ­¥ç‰ˆæœ¬æ·±åº¦ç ”ç©¶")
    print("=" * 60)
    
    researcher = DeepResearcher()
    
    topic = "äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—è¯Šæ–­ä¸­çš„åº”ç”¨"
    
    # åŒæ­¥æ‰§è¡Œ
    result = researcher.agent.execute_research(
        topic=topic,
        goals=["äº†è§£ AI åŒ»ç–—è¯Šæ–­çš„åº”ç”¨ç°çŠ¶", "åˆ†æä¸»è¦æŠ€æœ¯è·¯çº¿"]
    )
    
    print(f"\nâœ… ç ”ç©¶å®Œæˆ: {topic}")
    print(f"   æŠ¥å‘Šé•¿åº¦: {len(result.get('final_report', ''))} å­—ç¬¦")


if __name__ == "__main__":
    asyncio.run(main())
    sync_demo()
```

### 4.5 è‡ªå®šä¹‰æ™ºèƒ½ä½“å¼€å‘

å­¦ä¹ å¦‚ä½•æ‰©å±•å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼š

```python
# examples/ch04/02_custom_subagent.py
"""
è‡ªå®šä¹‰å­æ™ºèƒ½ä½“ç¤ºä¾‹
å­¦ä¹ å¦‚ä½•åˆ›å»ºæ–°çš„å­æ™ºèƒ½ä½“
"""

from typing import Dict, List, Any
from langchain_core.tools import BaseTool
from deep_research.subagents import BaseSubAgent
from config import get_logger

logger = get_logger(__name__)


class DataVisualizerSubAgent(BaseSubAgent):
    """æ•°æ®å¯è§†åŒ–å­æ™ºèƒ½ä½“"""
    
    @property
    def name(self) -> str:
        return "DataVisualizer"
    
    @property
    def description(self) -> str:
        return "è´Ÿè´£æ•°æ®å¯è§†åŒ–å’Œå›¾è¡¨ç”Ÿæˆçš„æ™ºèƒ½ä½“"
    
    def get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªæ•°æ®å¯è§†åŒ–ä¸“å®¶ã€‚

ä½ çš„èŒè´£ï¼š
1. æ ¹æ®æ•°æ®ç”Ÿæˆåˆé€‚çš„å›¾è¡¨
2. é€‰æ‹©æœ€åˆé€‚çš„å¯è§†åŒ–ç±»å‹
3. ä¼˜åŒ–å›¾è¡¨çš„ç¾è§‚æ€§å’Œå¯è¯»æ€§
4. ç”Ÿæˆå¯ç”¨äºæŠ¥å‘Šçš„å›¾è¡¨å›¾ç‰‡

å¯è§†åŒ–åŸåˆ™ï¼š
- é€‰æ‹©æœ€èƒ½è¡¨è¾¾æ•°æ®å«ä¹‰çš„å›¾è¡¨ç±»å‹
- ä¿æŒå›¾è¡¨ç®€æ´æ˜äº†
- ä½¿ç”¨æ¸…æ™°çš„æ ‡ç­¾å’Œæ ‡é¢˜
- æ³¨æ„é¢œè‰²æ­é…å’Œæ•´ä½“ç¾è§‚
"""
    
    def get_tools(self) -> List[BaseTool]:
        """è·å–å¯è§†åŒ–å·¥å…·"""
        from core.tools import filesystem
        return [filesystem]
    
    def execute(self, task: str, context: Dict[str, Any] = None) -> Dict[str, Any]:
        """æ‰§è¡Œå¯è§†åŒ–ä»»åŠ¡"""
        logger.info(f"ğŸ“Š DataVisualizer æ‰§è¡Œä»»åŠ¡: {task}")
        
        # å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨å›¾è¡¨ç”Ÿæˆåº“
        result = f"å¯è§†åŒ–ä»»åŠ¡å·²åˆ›å»º: {task}"
        
        return {
            "agent": self.name,
            "task": task,
            "result": result,
            "chart_path": None  # ç”Ÿæˆåçš„å›¾è¡¨è·¯å¾„
        }


class LiteratureReviewSubAgent(BaseSubAgent):
    """æ–‡çŒ®ç»¼è¿°å­æ™ºèƒ½ä½“"""
    
    @property
    def name(self) -> str:
        return "LiteratureReviewer"
    
    @property
    def description(self) -> str:
        return "è´Ÿè´£å­¦æœ¯æ–‡çŒ®ç»¼è¿°å’Œåˆ†æçš„æ™ºèƒ½ä½“"
    
    def get_system_prompt(self) -> str:
        return """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å­¦æœ¯æ–‡çŒ®ç»¼è¿°ä¸“å®¶ã€‚

ä½ çš„èŒè´£ï¼š
1. ç³»ç»Ÿæ€§æ”¶é›†å’Œæ•´ç†ç›¸å…³æ–‡çŒ®
2. åˆ†ææ–‡çŒ®çš„ä¸»è¦è§‚ç‚¹å’Œæ–¹æ³•
3. è¯†åˆ«ç ”ç©¶è¶‹åŠ¿å’Œç©ºç™½
4. ç»¼åˆå¤šæ–¹è§‚ç‚¹å½¢æˆç»¼è¿°

ç»¼è¿°è¦æ±‚ï¼š
- å®¢è§‚å‘ˆç°ä¸åŒç ”ç©¶è§‚ç‚¹
- æ¸…æ™°æ ‡æ³¨æ–‡çŒ®æ¥æº
- è¯†åˆ«ç ”ç©¶çš„ä¸€è‡´æ€§å’Œåˆ†æ­§
- æŒ‡å‡ºæœªæ¥ç ”ç©¶æ–¹å‘
"""
    
    def get_tools(self) -> List[BaseTool]:
        """è·å–æ–‡çŒ®å·¥å…·"""
        from core.tools import filesystem, web_search
        return [filesystem, web_search]
    
    def execute(self, task: str, context: Dict[str, Any] = None) -> Dict[str, Any]:
        """æ‰§è¡Œæ–‡çŒ®ç»¼è¿°ä»»åŠ¡"""
        logger.info(f"ğŸ“š LiteratureReviewer æ‰§è¡Œä»»åŠ¡: {task}")
        
        result = f"æ–‡çŒ®ç»¼è¿°ä»»åŠ¡: {task}"
        
        return {
            "agent": self.name,
            "task": task,
            "result": result
        }


def demonstrate_custom_agents():
    """æ¼”ç¤ºè‡ªå®šä¹‰å­æ™ºèƒ½ä½“"""
    
    print("=" * 60)
    print("ğŸ”§ è‡ªå®šä¹‰å­æ™ºèƒ½ä½“æ¼”ç¤º")
    print("=" * 60)
    
    # åˆ›å»ºè‡ªå®šä¹‰æ™ºèƒ½ä½“
    visualizer = DataVisualizerSubAgent()
    reviewer = LiteratureReviewSubAgent()
    
    print(f"\nğŸ“Š DataVisualizer: {visualizer.description}")
    print(f"   ç³»ç»Ÿæç¤ºè¯é•¿åº¦: {len(visualizer.get_system_prompt())} å­—ç¬¦")
    print(f"   å·¥å…·æ•°é‡: {len(visualizer.get_tools())}")
    
    print(f"\nğŸ“š LiteratureReviewer: {reviewer.description}")
    print(f"   ç³»ç»Ÿæç¤ºè¯é•¿åº¦: {len(reviewer.get_system_prompt())} å­—ç¬¦")
    print(f"   å·¥å…·æ•°é‡: {len(reviewer.get_tools())}")
    
    # åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹
    agent = visualizer.create_agent()
    print(f"\nâœ… {visualizer.name} æ™ºèƒ½ä½“åˆ›å»ºæˆåŠŸ")


if __name__ == "__main__":
    demonstrate_custom_agents()
```

## æ•™å­¦è¦ç‚¹

### 4.1 å¤šæ™ºèƒ½ä½“ç³»ç»Ÿè®¾è®¡åŸåˆ™

è®¾è®¡å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ—¶ï¼ŒèŒè´£åˆ†ç¦»æ˜¯æœ€é‡è¦çš„åŸåˆ™ã€‚æ¯ä¸ªæ™ºèƒ½ä½“åº”è¯¥æœ‰æ˜ç¡®çš„ã€å•ä¸€çš„èŒè´£èŒƒå›´ã€‚é¿å…åˆ›å»º"ä¸‡èƒ½"æ™ºèƒ½ä½“ï¼Œè€Œæ˜¯åˆ›å»ºå¤šä¸ªä¸“ä¸šåŒ–çš„æ™ºèƒ½ä½“ã€‚èŒè´£çš„åˆ’åˆ†åº”è¯¥åŸºäºå®é™…ä¸šåŠ¡æµç¨‹ï¼Œè®©æ¯ä¸ªæ™ºèƒ½ä½“éƒ½èƒ½åœ¨å…¶ä¸“ä¸šé¢†åŸŸå†…åšåˆ°æœ€å¥½ã€‚

é€šä¿¡æœºåˆ¶çš„è®¾è®¡éœ€è¦è€ƒè™‘æ•ˆç‡å’Œå¯é æ€§ã€‚åŒæ­¥é€šä¿¡é€‚ç”¨äºéœ€è¦ç«‹å³å“åº”çš„åœºæ™¯ï¼Œå¼‚æ­¥é€šä¿¡é€‚ç”¨äºè€—æ—¶çš„ä»»åŠ¡ã€‚æ¶ˆæ¯æ ¼å¼åº”è¯¥æ ‡å‡†åŒ–ï¼ŒåŒ…å«ä»»åŠ¡æè¿°ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€æœŸæœ›è¾“å‡ºç­‰ã€‚é”™è¯¯å¤„ç†æœºåˆ¶åº”è¯¥å®Œå–„ï¼Œç¡®ä¿ä¸€ä¸ªæ™ºèƒ½ä½“çš„é”™è¯¯ä¸ä¼šå½±å“å…¶ä»–æ™ºèƒ½ä½“ã€‚

ä»»åŠ¡åˆ†è§£éœ€è¦å¹³è¡¡ç²’åº¦å’Œå¯ç®¡ç†æ€§ã€‚ä»»åŠ¡å¤ªç²—ä¼šå¯¼è‡´éš¾ä»¥è·Ÿè¸ªè¿›åº¦å’Œåˆ†é…èµ„æºï¼›ä»»åŠ¡å¤ªç»†ä¼šäº§ç”Ÿè¿‡å¤šçš„åè°ƒå¼€é”€ã€‚åˆç†çš„ç²’åº¦æ˜¯å•ä¸ªæ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆï¼ŒåŒæ—¶åˆè¶³å¤Ÿå…·ä½“ä»¥ä¾¿ç‹¬ç«‹æ‰§è¡Œã€‚

### 4.2 å­æ™ºèƒ½ä½“å¼€å‘æœ€ä½³å®è·µ

å­æ™ºèƒ½ä½“çš„ç³»ç»Ÿæç¤ºè¯åº”è¯¥æ¸…æ™°ã€å…·ä½“ã€‚æ˜ç¡®æ™ºèƒ½ä½“çš„è§’è‰²å®šä½ã€å·¥ä½œèŒè´£ã€è¾“å‡ºæ ¼å¼è¦æ±‚ã€‚æç¤ºè¯ä¸­åº”è¯¥åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè®©æ™ºèƒ½ä½“èƒ½å¤Ÿç†è§£ä»»åŠ¡çš„èƒŒæ™¯å’Œç›®æ ‡ã€‚åŒæ—¶ä¹Ÿè¦è®¾ç½®å¿…è¦çš„é™åˆ¶ï¼Œé˜²æ­¢æ™ºèƒ½ä½“åç¦»é¢„æœŸçš„è¡Œä¸ºã€‚

å·¥å…·çš„é€‰æ‹©åº”è¯¥ä¸æ™ºèƒ½ä½“çš„èŒè´£ç›¸åŒ¹é…ã€‚æ¯ä¸ªæ™ºèƒ½ä½“åªéœ€è¦æ‹¥æœ‰å®Œæˆå…¶èŒè´£æ‰€éœ€çš„å·¥å…·ï¼Œè¿‡å¤šçš„å·¥å…·ä¼šå¢åŠ æ™ºèƒ½ä½“çš„å†³ç­–è´Ÿæ‹…ï¼Œä¹Ÿä¼šå¢åŠ å‡ºé”™çš„å¯èƒ½æ€§ã€‚å·¥å…·åº”è¯¥æœ‰è‰¯å¥½çš„æ–‡æ¡£è¯´æ˜ï¼ŒåŒ…æ‹¬ç”¨é€”ã€å‚æ•°ã€è¿”å›å€¼ç­‰ã€‚

é”™è¯¯å¤„ç†æ˜¯å­æ™ºèƒ½ä½“å¼€å‘ä¸­å¿…é¡»è€ƒè™‘çš„é—®é¢˜ã€‚æ™ºèƒ½ä½“åº”è¯¥èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼Œå¦‚å·¥å…·è°ƒç”¨å¤±è´¥ã€è¾“å…¥æ— æ•ˆã€è¶…æ—¶ç­‰ã€‚é”™è¯¯ä¿¡æ¯åº”è¯¥æ¸…æ™°ã€æœ‰å¸®åŠ©ï¼Œä¾¿äºä¸»æ™ºèƒ½ä½“ç†è§£å’Œå¤„ç†ã€‚

### 4.3 ç ”ç©¶ä»»åŠ¡è§„åˆ’ç­–ç•¥

ç ”ç©¶ä»»åŠ¡çš„è§„åˆ’åº”è¯¥éµå¾ªç”±æµ…å…¥æ·±ã€ç”±å¹¿åˆ°çª„çš„åŸåˆ™ã€‚é¦–å…ˆè¿›è¡Œå¹¿æ³›çš„ä¿¡æ¯æ”¶é›†ï¼Œå»ºç«‹å¯¹ç ”ç©¶ä¸»é¢˜çš„æ•´ä½“è®¤çŸ¥ï¼›ç„¶åé€æ­¥èšç„¦ï¼Œæ·±å…¥æ¢ç´¢å…³é”®é—®é¢˜ï¼›æœ€åè¿›è¡Œç»¼åˆåˆ†æï¼Œå½¢æˆå®Œæ•´çš„ç ”ç©¶ç»“è®ºã€‚è¿™ç§æ¸è¿›å¼çš„è§„åˆ’èƒ½å¤Ÿç¡®ä¿ç ”ç©¶çš„å…¨é¢æ€§å’Œæ·±åº¦ã€‚

æ—¶é—´åˆ†é…æ˜¯ç ”ç©¶è§„åˆ’çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä¸åŒç±»å‹çš„ç ”ç©¶ä»»åŠ¡éœ€è¦ä¸åŒçš„æ—¶é—´ï¼šä¿¡æ¯æ”¶é›†éœ€è¦è¶³å¤Ÿçš„æ—¶é—´æ¥ç¡®ä¿è¦†ç›–é¢çš„å¹¿åº¦ï¼›ä¿¡æ¯åˆ†æéœ€è¦æ·±å…¥æ€è€ƒçš„æ—¶é—´ï¼›æŠ¥å‘Šæ’°å†™éœ€è¦å……è¶³çš„è¿­ä»£å’Œä¿®æ”¹æ—¶é—´ã€‚åˆç†çš„åˆ†é…èƒ½å¤Ÿç¡®ä¿æ¯ä¸ªç¯èŠ‚éƒ½å¾—åˆ°å……åˆ†çš„å¤„ç†ã€‚

ç ”ç©¶çš„èŒƒå›´ç•Œå®šå¾ˆé‡è¦ã€‚è¿‡äºå®½æ³›çš„ç ”ç©¶ä¼šå¯¼è‡´èµ„æºåˆ†æ•£ï¼Œéš¾ä»¥æ·±å…¥ï¼›è¿‡äºç‹­çª„çš„ç ”ç©¶å¯èƒ½é—æ¼é‡è¦çš„ç›¸å…³ä¿¡æ¯ã€‚åœ¨å¼€å§‹ç ”ç©¶ä¹‹å‰ï¼Œåº”è¯¥æ˜ç¡®ç ”ç©¶çš„æ ¸å¿ƒé—®é¢˜å’Œè¾¹ç•ŒèŒƒå›´ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ ¹æ®éœ€è¦åŠ¨æ€è°ƒæ•´ã€‚

## è¯¾åä½œä¸š

### åŸºç¡€ä½œä¸š

**ä½œä¸š 1ï¼šæ‰©å±•å­æ™ºèƒ½ä½“**

ä¸ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ·»åŠ æ–°çš„å­æ™ºèƒ½ä½“ã€‚è¦æ±‚ï¼š
- è®¾è®¡ä¸€ä¸ªæ–°çš„å­æ™ºèƒ½ä½“ç±»å‹ï¼ˆå¦‚ CodeExpertã€ExpertInterviewer ç­‰ï¼‰
- å®ç°å®Œæ•´çš„å­æ™ºèƒ½ä½“ç±»
- ç¼–å†™æµ‹è¯•ç”¨ä¾‹éªŒè¯åŠŸèƒ½
- æ–‡æ¡£è¯´æ˜å…¶ç”¨é€”å’Œç‰¹ç‚¹

**ä½œä¸š 2ï¼šä»»åŠ¡è°ƒåº¦å™¨**

å®ç°ä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨ã€‚è¦æ±‚ï¼š
- æ”¯æŒä»»åŠ¡çš„ä¼˜å…ˆçº§è®¾ç½®
- å®ç°ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
- æ”¯æŒå¹¶è¡Œæ‰§è¡Œå­æ™ºèƒ½ä½“ä»»åŠ¡
- å®ç°ä»»åŠ¡ä¾èµ–å…³ç³»å¤„ç†

### ä¸­çº§ä½œä¸š

**ä½œä¸š 3ï¼šæ™ºèƒ½ä½“åä½œå·¥ä½œæµ**

è®¾è®¡å¹¶å®ç°æ™ºèƒ½ä½“åä½œå·¥ä½œæµã€‚è¦æ±‚ï¼š
- å®šä¹‰æ™ºèƒ½ä½“ä¹‹é—´çš„åä½œæ¨¡å¼
- å®ç°ç»“æœçš„ä¼ é€’å’Œå…±äº«
- æ”¯æŒåŠ¨æ€è°ƒæ•´åä½œæµç¨‹
- æä¾›åä½œè¿‡ç¨‹çš„å¯è§†åŒ–

**ä½œä¸š 4ï¼šç ”ç©¶è´¨é‡è¯„ä¼°**

å®ç°ç ”ç©¶è´¨é‡è¯„ä¼°æ¨¡å—ã€‚è¦æ±‚ï¼š
- è¯„ä¼°æ”¶é›†èµ„æ–™çš„è´¨é‡å’Œå¯é æ€§
- åˆ†æå¼•ç”¨æ¥æºçš„æƒå¨æ€§
- æ£€æµ‹ç ”ç©¶ç»“è®ºçš„ä¸€è‡´æ€§
- ç”Ÿæˆè´¨é‡è¯„ä¼°æŠ¥å‘Š

### é«˜çº§ä½œä¸š

**ä½œä¸š 5ï¼šè‡ªé€‚åº”å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ**

è®¾è®¡è‡ªé€‚åº”å¤šæ™ºèƒ½ä½“ç³»ç»Ÿã€‚è¦æ±‚ï¼š
- æ ¹æ®ä»»åŠ¡å¤æ‚åº¦åŠ¨æ€é€‰æ‹©æ™ºèƒ½ä½“ç»„åˆ
- å®ç°æ™ºèƒ½ä½“çš„è‡ªæˆ‘ä¼˜åŒ–æœºåˆ¶
- æ”¯æŒè¿è¡Œæ—¶æ·»åŠ /ç§»é™¤æ™ºèƒ½ä½“
- æä¾›æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜å»ºè®®

**ä½œä¸š 6ï¼šåˆ†å¸ƒå¼ç ”ç©¶å¹³å°**

è®¾è®¡åˆ†å¸ƒå¼ç ”ç©¶å¹³å°ã€‚è¦æ±‚ï¼š
- æ”¯æŒå¤šä¸ªç ”ç©¶ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
- å®ç°è·¨ä»»åŠ¡çš„èµ„æºå…±äº«
- æ”¯æŒç ”ç©¶è¿›åº¦çš„åˆ†å¸ƒå¼è·Ÿè¸ª
- å®ç°å®¹é”™å’Œæ¢å¤æœºåˆ¶

## ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¤šæ™ºèƒ½ä½“åä½œæ¡†æ¶

```python
# deep_research/multi_agent_framework.py
"""
å¤šæ™ºèƒ½ä½“åä½œæ¡†æ¶
æä¾›å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„åŸºç¡€æ¶æ„
"""

from typing import Dict, List, Any, Callable, Optional
from dataclasses import dataclass, field
from enum import Enum
from datetime import datetime
import asyncio
from config import get_logger

logger = get_logger(__name__)


class TaskStatus(Enum):
    """ä»»åŠ¡çŠ¶æ€"""
    PENDING = "pending"
    RUNNING = "running"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


@dataclass
class Task:
    """ä»»åŠ¡å®šä¹‰"""
    task_id: str
    name: str
    type: str
    description: str
    priority: int = 0
    dependencies: List[str] = field(default_factory=list)
    status: TaskStatus = TaskStatus.PENDING
    assigned_agent: Optional[str] = None
    input_data: Dict[str, Any] = field(default_factory=dict)
    output_data: Dict[str, Any] = field(default_factory=dict)
    error: Optional[str] = None
    created_at: datetime = field(default_factory=datetime.now)
    started_at: Optional[datetime] = None
    completed_at: Optional[datetime] = None


class AgentRegistry:
    """æ™ºèƒ½ä½“æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self._agents: Dict[str, Any] = {}
    
    def register(self, agent_type: str, agent_instance: Any):
        """æ³¨å†Œæ™ºèƒ½ä½“"""
        self._agents[agent_type] = agent_instance
        logger.info(f"æ³¨å†Œæ™ºèƒ½ä½“: {agent_type}")
    
    def get(self, agent_type: str) -> Optional[Any]:
        """è·å–æ™ºèƒ½ä½“"""
        return self._agents.get(agent_type)
    
    def list_types(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰æ™ºèƒ½ä½“ç±»å‹"""
        return list(self._agents.keys())


class MultiAgentCoordinator:
    """å¤šæ™ºèƒ½ä½“åè°ƒå™¨"""
    
    def __init__(self):
        self.registry = AgentRegistry()
        self.task_queue: List[Task] = []
        self.task_results: Dict[str, Any] = {}
    
    def register_agent(self, agent_type: str, agent_instance: Any):
        """æ³¨å†Œæ™ºèƒ½ä½“"""
        self.registry.register(agent_type, agent_instance)
    
    def create_task(
        self,
        name: str,
        task_type: str,
        description: str,
        priority: int = 0,
        dependencies: List[str] = None,
        input_data: Dict[str, Any] = None
    ) -> Task:
        """åˆ›å»ºä»»åŠ¡"""
        import uuid
        task_id = str(uuid.uuid4())[:8]
        
        task = Task(
            task_id=task_id,
            name=name,
            type=task_type,
            description=description,
            priority=priority,
            dependencies=dependencies or [],
            input_data=input_data or {}
        )
        
        self.task_queue.append(task)
        logger.info(f"åˆ›å»ºä»»åŠ¡: {name} ({task_type})")
        
        return task
    
    async def execute_task(self, task: Task) -> Dict[str, Any]:
        """æ‰§è¡Œå•ä¸ªä»»åŠ¡"""
        logger.info(f"æ‰§è¡Œä»»åŠ¡: {task.name}")
        
        # è·å–æ™ºèƒ½ä½“
        agent = self.registry.get(task.type)
        if not agent:
            return {"error": f"æœªæ‰¾åˆ°æ™ºèƒ½ä½“ç±»å‹: {task.type}"}
        
        # æ‰§è¡Œä»»åŠ¡
        try:
            if hasattr(agent, 'execute'):
                result = agent.execute(task.description, task.input_data)
            else:
                result = agent(task.description)
            
            task.output_data = result
            task.status = TaskStatus.COMPLETED
            task.completed_at = datetime.now()
            
            return result
            
        except Exception as e:
            task.status = TaskStatus.FAILED
            task.error = str(e)
            logger.error(f"ä»»åŠ¡æ‰§è¡Œå¤±è´¥: {task.name}, é”™è¯¯: {e}")
            return {"error": str(e)}
    
    async def execute_all(self, parallel: bool = False) -> Dict[str, Any]:
        """æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡"""
        results = {}
        
        if parallel:
            # å¹¶è¡Œæ‰§è¡Œ
            tasks_to_execute = [t for t in self.task_queue if t.status == TaskStatus.PENDING]
            
            # åˆ›å»ºåç¨‹
            coroutines = [self.execute_task(t) for t in tasks_to_execute]
            
            # æ‰§è¡Œ
            outputs = await asyncio.gather(*coroutines, return_exceptions=True)
            
            for task, output in zip(tasks_to_execute, outputs):
                results[task.task_id] = output
        
        else:
            # é¡ºåºæ‰§è¡Œ
            for task in self.task_queue:
                if task.status == TaskStatus.PENDING:
                    output = await self.execute_task(task)
                    results[task.task_id] = output
        
        self.task_results = results
        return results
    
    def get_status(self) -> Dict[str, Any]:
        """è·å–æ‰§è¡ŒçŠ¶æ€"""
        return {
            "total_tasks": len(self.task_queue),
            "completed": sum(1 for t in self.task_queue if t.status == TaskStatus.COMPLETED),
            "failed": sum(1 for t in self.task_queue if t.status == TaskStatus.FAILED),
            "pending": sum(1 for t in self.task_queue if t.status == TaskStatus.PENDING),
            "agent_types": self.registry.list_types()
        }


# ä½¿ç”¨ç¤ºä¾‹
def example_usage():
    """ä½¿ç”¨ç¤ºä¾‹"""
    from deep_research.subagents import (
        WebResearcherSubAgent,
        DocAnalystSubAgent,
        ReportWriterSubAgent
    )
    
    # åˆ›å»ºåè°ƒå™¨
    coordinator = MultiAgentCoordinator()
    
    # æ³¨å†Œæ™ºèƒ½ä½“
    coordinator.register_agent("web_researcher", WebResearcherSubAgent())
    coordinator.register_agent("doc_analyst", DocAnalystSubAgent())
    coordinator.register_agent("report_writer", ReportWriterSubAgent())
    
    # åˆ›å»ºä»»åŠ¡
    coordinator.create_task(
        name="æœç´¢ AI æ•™è‚²åº”ç”¨",
        task_type="web_researcher",
        description="æœç´¢å¤§è¯­è¨€æ¨¡å‹åœ¨æ•™è‚²é¢†åŸŸçš„åº”ç”¨æ¡ˆä¾‹"
    )
    
    coordinator.create_task(
        name="åˆ†ææ”¶é›†çš„èµ„æ–™",
        task_type="doc_analyst",
        description="åˆ†ææœç´¢åˆ°çš„èµ„æ–™ï¼Œæå–å…³é”®ä¿¡æ¯"
    )
    
    coordinator.create_task(
        name="ç”Ÿæˆç ”ç©¶æŠ¥å‘Š",
        task_type="report_writer",
        description="åŸºäºåˆ†æç»“æœç”Ÿæˆå®Œæ•´çš„ç ”ç©¶æŠ¥å‘Š"
    )
    
    # æ‰§è¡Œ
    import asyncio
    results = asyncio.run(coordinator.execute_all())
    
    print("æ‰§è¡Œå®Œæˆ!")
    print(f"ç»“æœæ•°é‡: {len(results)}")
```

## å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- LangChain Multi-Agent æ–‡æ¡£ï¼šhttps://docs.langchain.com/
- LangGraph Agents æ–‡æ¡£ï¼šhttps://docs.langgraph.com/
- OpenAI Function Callingï¼šhttps://platform.openai.com/docs/guides/function-calling

### æŠ€æœ¯è®ºæ–‡

- Multi-Agent Systems ç»¼è¿°ï¼šhttps://arxiv.org/abs/2308.11432
- AutoGPT æ¶æ„åˆ†æï¼šhttps://github.com/Significant-Gravitas/AutoGPT
- Agent åä½œæ¨¡å¼ï¼šhttps://arxiv.org/abs/2309.10852

### è¿›é˜¶èµ„æº

- Awesome Multi-Agentï¼šhttps://github.com/ai-planet/awesome-multi-agent
- MetaGPT é¡¹ç›®ï¼šhttps://github.com/geekan/MetaGPT
- CrewAI æ¡†æ¶ï¼šhttps://github.com/joaomdmoura/crewai
