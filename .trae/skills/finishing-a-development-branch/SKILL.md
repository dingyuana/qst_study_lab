# 完成开发分支

## 何时激活

此技能在以下情况下自动激活：

- 完成一项任务后
- 准备合并分支前
- 准备发起 Pull Request 前
- 需要清理工作区时

## 目标

此技能的目标是完成开发分支的工作，并准备合并到主分支。

在完成分支之前，你需要：

1. **验证所有任务完成：** 确保所有计划中的任务都已完成
2. **验证测试通过：** 确保所有测试通过
3. **验证代码质量：** 确保代码符合质量标准
4. **准备合并：** 准备合并到主分支
5. **清理工作区：** 清理工作区

## 步骤

### 1. 验证任务完成

确保所有计划中的任务都已完成：

1. **回顾计划：** 回顾初始计划
2. **检查任务状态：** 检查每个任务的状态
3. **确认完成：** 确认每个任务都已完成

### 2. 验证测试通过

确保所有测试通过：

1. **运行相关测试：** 运行与更改相关的测试
2. **运行完整测试套件：** 运行整个测试套件
3. **检查测试覆盖率：** 确保测试覆盖率

### 3. 验证代码质量

确保代码符合质量标准：

1. **运行 linter：** 运行 linter 以检查代码风格
2. **运行类型检查：** 如果使用类型检查，确保类型检查通过
3. **自我审查代码：** 自我审查代码以查找问题

### 4. 准备合并

准备合并到主分支：

1. **与主分支同步：** 确保分支与主分支同步
2. **解决冲突：** 解决任何合并冲突
3. **更新分支：** 更新分支以反映最新更改

### 5. 清理工作区

清理工作区：

1. **移除不必要的文件：** 移除临时文件
2. **清理 worktree：** 如果使用 worktree，清理不再需要的 worktree
3. **更新文档：** 确保文档已更新

## 分支完成选项

在完成分支时，有几个选项：

### 选项一：合并到主分支

如果分支已经准备好，可以合并到主分支：

```bash
# 切换到主分支
git checkout main

# 拉取最新更改
git pull

# 合并分支
git merge feature/my-feature

# 删除分支
git branch -d feature/my-feature
```

### 选项二：创建 Pull Request

如果需要代码审查，可以创建 Pull Request：

```bash
# 推送分支
git push origin feature/my-feature

# 在 GitHub/GitLab 上创建 Pull Request
```

### 选项三：保留分支

如果分支还没有准备好，可以保留分支以便后续工作：

```bash
# 确保所有更改已提交
git add .
git commit -m "WIP: Work in progress"

# 推送分支
git push origin feature/my-feature
```

### 选项四：丢弃分支

如果分支不再需要，可以丢弃分支：

```bash
# 切换到主分支
git checkout main

# 删除分支
git branch -D feature/my-feature
```

## 提交消息格式

使用以下格式编写提交消息：

```
[type]: [subject]

[body]

[footer]
```

### 类型

- **feat：** 新功能
- **fix：** Bug 修复
- **docs：** 文档更新
- **style：** 代码格式调整
- **refactor：** 重构
- **test：** 测试相关
- **chore：** 构建过程或辅助工具的更改

### 示例

```
feat: 添加用户认证功能

- 添加用户注册端点
- 添加用户登录端点
- 添加 JWT 令牌生成

Closes #123
```

## 检查清单

在完成分支之前，完成以下检查清单：

- [ ] 所有计划中的任务都已完成
- [ ] 所有测试通过
- [ ] Linter 通过
- [ ] 类型检查通过（如果适用）
- [ ] 代码已被审查
- [ ] 分支与主分支同步
- [ ] 没有未解决的合并冲突
- [ ] 文档已更新
- [ ] 临时文件已清理
- [ ] Worktree 已清理（如果使用）

## 与其他技能的集成

此技能可以与以下技能一起使用：

- **writing-plans：** 使用计划来跟踪任务
- **executing-plans：** 使用执行计划来完成任务
- **subagent-driven-development：** 使用子代理来完成子任务
- **requesting-code-review：** 使用代码审查来确保代码质量
- **using-git-worktrees：** 使用 worktree 来隔离工作

## 常见错误

### 不验证测试

不要跳过测试验证。测试失败会导致问题。

### 不与主分支同步

不要忽略与主分支同步。不同步会导致合并冲突。

### 不清理工作区

不要跳过工作区清理。临时文件会污染仓库。

### 不更新文档

不要忽略文档更新。过时的文档会导致混淆。

## 示例

### 不好

> **不好方法：**
> - 完成编码
> - 直接合并到主分支
> - 不运行测试
> - 不清理工作区

### 好

> **好方法：**
> 
> **验证任务完成：**
> - 回顾计划：所有任务完成
> - 检查任务状态：全部完成
> 
> **验证测试通过：**
> - 运行相关测试：全部通过
> - 运行完整测试套件：全部通过
> 
> **验证代码质量：**
> - 运行 linter：通过
> - 运行类型检查：通过
> - 自我审查代码：没有问题
> 
> **准备合并：**
> - 切换到主分支
> - 拉取最新更改
> - 合并分支
> 
> **清理工作区：**
> - 移除临时文件
> - 清理 worktree
> - 更新文档

## 后续操作

在完成分支后：

1. **通知团队：** 通知团队分支已完成
2. **更新问题跟踪：** 如果适用，更新问题跟踪系统
3. **庆祝：** 庆祝完成！
4. **开始下一个任务：** 开始下一个任务
